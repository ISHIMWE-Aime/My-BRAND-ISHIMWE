<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignUp</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.tutorialjinni.com/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <script src="https://cdn.tutorialjinni.com/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
</head>
<body>
     
    <div class="guest">
        <h1 class="guest-title">Guest</h1>
        <form action="" class="guest-form">
            <div >
                <input type="text" name="firstName" placeholder="Enter your first name" id="firstNameInput" />
                <div class="ErrorMessages" id="firstNameErrorMessage"></div>
            </div>
            <div >
                <input type="text" name="middleName" placeholder="Enter your middle name (Optional)" id="middleNameInput" />
                <div class="ErrorMessages" id="middleNameErrorMessage"></div>
            </div>
            <div >
                <input type="text" name="lastName" placeholder="Enter your last name" id="lastNameInput" />
                <div class="ErrorMessages" id="lastNameErrorMessage"></div>
            </div>
            <div >
                <input type="email" name="email" placeholder="Enter your email. i.e example@gmail.com" id="emailinput" />
                <div class="ErrorMessages" id="emailErrorMessage"></div>
            </div>
            <select name="userPreference" id="fieldsInput">
                <option value="Enter your prefered field">Enter your prefered field</option>
                <option value="Web-development">Web-development</option>
                <option value="JavaScript">JavaScript</option>
            </select>
            <!-- <div class="ErrorMessages" id="userPreferenceErrorMessage"></div> -->
            <div class="telephone">
                <input name="phone" type="text" placeholder="i.e 7xx xxx xxx" id="phone"/>
                <div class="ErrorMessages" id="phoneNumberErrorMessage"></div> 
            </div>
            
            <div >
                <input type="password" name="password" placeholder="Password (6 or more characters)" id="passwordinput" class="" required />
                <div class="ErrorMessages" id="passErrorMessage"></div>
                <!-- <img src="" alt="show_password"> -->
            </div>
            <div >
                <input type="password" name="confirmPassword" placeholder="Confirm Password" id="passwordinputConfirm"  class="" required />
                <div class="ErrorMessages" id="passConfirmErrorMessage"></div>
                <!-- <img src="" alt="show_password"> -->
            </div>

            <div id="more-button" > <!-- onclick="location.href = 'userLogin.html';" -->
                <div id="more">
                    <p id="more-text">
                        <button>Sign Up</button>
                    </p>
                    <div id="dashedcycle">
                        <div id="whiteCycle"></div>
                    </div>
                </div>
            </div>
        </form>

        <p class="bottom-text">You have account? 
            <a href="userLogin.html">Back to Log in</span>
        </p>
    </div>
    <div>
        <div id="diamondGradient">
            <button type="button" id="backButton"><img src="images/icons/VectorBackIcon.png" alt="" id="backIcon">Back</button>
        </div>
    </div>
    <footer>
        <nav>
            <div id="web">
                <h2 id="main-pro" style="color: white;">Web-developer</h2>
            </div>
            <div id="footerOptions">
                <a class="navItems" href="index.html" target="_self">Home</a>
                <a class="navItems" href="index.html" target="_self">Technical skills</a>
                <a class="navItems" href="index.html" target="_self">Portifolio</a>
                <a class="navItems" href="index.html" target="_self">Contacts</a>
                <a class="navItems" href="userLogin.html" target="_self">Log in</a>
            </div>
            <a href="http://#" target="_self" style="width: 10%; font-weight: 600; padding-top: 1.5%;">ISHIMWE A.F</a>
        </nav>
    </footer>

    <script src="JS/countryCode.js"></script>
    
    <script>
        const form = document.querySelector('form')
        const selectedCode = document.getElementsByClassName("iti__selected-dial-code")[0].innerHTML
        const confirmInput = document.getElementById("passwordinputConfirm");
        const userpass = document.getElementById("passwordinput");
        const subButton = document.querySelector('#more-button')

        const firstNameErrorEl = document.querySelector('#firstNameErrorMessage')
        const middleNameErrorEl = document.querySelector('#middleNameErrorMessage')
        const lastNameErrorEl = document.querySelector('#lastNameErrorMessage')
        const emailErrorEl = document.querySelector('#emailErrorMessage')
        const phoneNumberErrorEl = document.querySelector('#phoneNumberErrorMessage')
        const passwordErrorEl = document.querySelector('#passErrorMessage')
        

        let password
        confirmInput.addEventListener("input", function(){
            if(userpass.value !== confirmInput.value){
                passConfirmErrorMessage.innerHTML = `
                <p style="color: rgb(255, 100, 0); font-size: 15px;">The passWord not matching.<p>
                `
            } else{
                if( confirmInput.value.length !== 0){

                    password = form.password.value

                    passConfirmErrorMessage.innerHTML = `
                    <p style="color: greenyellow; font-size: 15px;">Match.<p>
                    `
                }
            }
        })

        form.addEventListener('submit', async (e) => {
            e.preventDefault()

            // console.log(selectedCode);
            // console.log(form.email.value, form.userPreference.value)

            // reset error messages
            firstNameErrorEl.innerHTML = ''
            middleNameErrorEl.innerHTML = ''
            lastNameErrorEl.innerHTML = ''
            emailErrorEl.innerHTML = ''
            phoneNumberErrorEl.innerHTML = ''
            passwordErrorEl.innerHTML = ''

            // get values of inputs
            const firstName = form.firstName.value
            const middleName = form.middleName.value
            const lastName = form.lastName.value
            const email = form.email.value
            const userPreference = form.userPreference.value
            const phoneCountryCode = selectedCode
            const phone = form.phone.value            

            const newUser = { firstName, middleName, lastName, email, userPreference, phoneCountryCode, phone, password }
            
            try {
                const res = await fetch('https://important-red-beanie.cyclic.app/userRegister', {
                    method: 'POST',
                    body: JSON.stringify(newUser),
                    headers: { 'Content-Type': 'application/json' },
                })

                const resMessage = await res.json()
                console.log(resMessage)

                if(!resMessage.statusCode){
                    console.log(resMessage.password)

                    if((!resMessage.firstName)){
                        firstNameErrorEl.innerHTML = ''
                    }
                    else{
                        firstNameErrorEl.innerHTML = resMessage.firstName
                    }

                    if((!resMessage.lastName)){
                        lastNameErrorEl.innerHTML = ''
                    }
                    else{
                        lastNameErrorEl.innerHTML = resMessage.lastName
                    }

                    if((!resMessage.phone)){
                        phoneNumberErrorEl.innerHTML = ''
                    }
                    else{
                        phoneNumberErrorEl.innerHTML = resMessage.phone
                    }

                    emailErrorEl.innerHTML = resMessage.email
                    passwordErrorEl.innerHTML = resMessage.password
                }

                if(resMessage.statusCode === 200){
                    console.log('button changed');
                    // subButton.innerHTML = `
                    // <div id="more-button" onclick="location.href = 'userLogin.html';">
                    //     <div id="more">
                    //         <p id="more-text">
                    //             <button>Sign Up</button>
                    //         </p>
                    //         <div id="dashedcycle">
                    //             <div id="whiteCycle"></div>
                    //         </div>
                    //     </div>
                    // </div>
                    // `
                    location.href = 'userLogin.html'
                    //location.assign('/index.html')
                }
            } catch (error) {
                console.log(error);
            }
        })
    </script>
</body>
</html>